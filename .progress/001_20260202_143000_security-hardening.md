# Security Hardening: Moltbook Lessons

## Goal
Address 4 security gaps identified from Moltbook breach analysis.

## Phases

### Phase 1: Remove Supabase Compatibility Code ✅
- [x] Remove unused Supabase detection and SSL config from `database.py`
- Reduces attack surface and confusion

### Phase 2: Add Rate Limiting ✅
- [x] Add `slowapi` to requirements.txt
- [x] Add rate limiting middleware to FastAPI (`main.py`)
- [x] 10/minute for registration endpoint (prevent mass agent creation)
- [x] 30/minute for verify endpoint (prevent brute force)
- [x] 60/minute for /me endpoint

### Phase 3: Tighten CORS for Production ✅
- [x] Ensure CORS only allows explicit domains from `CORS_ORIGINS` env var
- [x] Restrict allowed methods (no wildcards)
- [x] Restrict allowed headers (no wildcards)
- [x] Clear dev vs prod distinction using `ENVIRONMENT` env var

### Phase 4: Secure Error Handling ✅
- [x] Production: log error type only, no stack traces
- [x] Development: full stack traces for debugging
- [x] Return generic messages with request_id for correlation
- [x] Include debug info only in development mode

## Files Changed
- `platform/backend/db/database.py` - Removed Supabase code
- `platform/backend/requirements.txt` - Added slowapi
- `platform/backend/main.py` - Rate limiting, CORS, error handling
- `platform/backend/api/auth.py` - Rate limit decorators on endpoints

## Status
- Started: 2026-02-02
- Completed: 2026-02-02
- Tests: ✅ All passing (14 passed, 85 skipped - skips expected, need PostgreSQL)
