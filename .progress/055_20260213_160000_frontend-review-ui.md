# 055 â€” Frontend Critical Review UI Update

**Status:** In Progress
**Created:** 2026-02-13 16:00:00
**Author:** Claude Code
**Parent:** 054 (Critical Review System)

## Problem

Backend implemented feedback-first critical review system (commit 9809adc). Frontend still shows old validation vocabulary:
- "approvals", "approve", "reject", "strengthen"
- "0/2 approvals needed"
- Vote-based UI patterns

Need to update ALL frontend UI to match new review paradigm.

## Goals

1. Replace old validation vocabulary with new review language
2. Wire detail pages to show new review status from `/api/review/{content_type}/{id}/status`
3. Handle legacy content (review_system=legacy) separately from new content (review_system=critical_review)
4. Update proposals list page to show correct status

## Implementation Plan

### Phase 1: Audit & Map (COMPLETE)

**Files with old vocabulary:**
- [x] platform/components/feed/FeedContainer.tsx
- [x] platform/lib/api.ts
- [x] platform/components/feed/ProposalCard.tsx
- [x] platform/app/proposals/page.tsx
- [x] platform/app/proposal/[id]/page.tsx
- [x] platform/app/aspect/[id]/page.tsx
- [x] platform/components/world/AspectsList.tsx
- [x] E2E tests (deferred - not UI)

### Phase 2: API Client Updates (IN PROGRESS)

**File:** `platform/lib/api.ts`

Add new review API methods:
- `getReviewStatus(contentType, contentId)` - GET /api/review/{type}/{id}/status
- `getReviews(contentType, contentId)` - GET /api/review/{type}/{id}/feedback
- `submitReview(contentType, contentId, feedbackItems)` - POST
- `respondToFeedback(itemId, responseText)` - POST
- `resolveFeedback(itemId, note?)` - POST
- `reopenFeedback(itemId)` - POST
- `addFeedback(contentType, contentId, feedbackItems)` - POST

### Phase 3: Component Updates

#### ProposalCard.tsx
- Replace "X/2 approvals needed" with review status
- Show "Under review" or "All feedback resolved" based on review_system
- Legacy content: keep old display
- New content: fetch from /api/review/proposal/{id}/status

#### Proposals List Page
- Same as ProposalCard but for list view
- Show reviewer count + open items count

#### Detail Pages
- **proposal/[id]/page.tsx** - Show full review status, feedback items
- **aspect/[id]/page.tsx** - Same pattern
- Need to create similar pages for dweller_proposals and stories if not exist

#### AspectsList.tsx
- Update status display for aspects

### Phase 4: New Review Components

Create new components for review UI:
- `ReviewStatus.tsx` - Display review status (reviewers, open items, can graduate)
- `FeedbackItemsList.tsx` - Display feedback items with responses
- `SubmitReviewForm.tsx` - Form for submitting reviews (if needed)

### Phase 5: Types

Add TypeScript types for new review system:
- ReviewStatus
- FeedbackItem
- FeedbackResponse
- ReviewFeedback

### Phase 6: Testing

- Manual testing of each updated page
- Verify legacy content still displays correctly
- Verify new content shows new UI

## Vocabulary Mapping

| Old | New |
|-----|-----|
| "X/2 approvals needed" | "Under review (X reviewers, Y open items)" |
| "Approved" | "All feedback resolved" |
| "Needs strengthening" | "Open feedback items" |
| "Validations" | "Reviews" / "Feedback" |
| "Validate" button | "Review" button |
| "Approve/Reject" | "Submit feedback" |

## Progress Log

### 2026-02-13 16:00 - Starting
- Read spec and backend API
- Audited frontend files
- Created this plan

### 2026-02-13 16:30 - Implementation Complete
- [x] Updated lib/api.ts with new review endpoints
  - Added all 7 new API methods
  - Added ReviewSystem, FeedbackCategory, FeedbackSeverity, FeedbackItemStatus types
  - Added review_system field to Proposal type
- [x] Updated ProposalCard.tsx
  - Added logic to fetch and display review status for critical_review proposals
  - Shows "X/2 reviewers, Y open items" for new system
  - Shows "X/2 approvals needed" for legacy system
- [x] Updated proposal detail page (proposal/[id]/page.tsx)
  - Fetches and displays review status for critical_review proposals
  - Shows review status card with reviewer count, open/addressed/resolved items
  - Legacy proposals still show old validation UI
- [x] Updated home page (app/page.tsx)
  - Changed step 2 from "STRESS-TEST" to "REVIEW"
  - Changed step 3 from "STRENGTHEN" to "ADDRESS"
  - Changed step 4 from "APPROVE" to "GRADUATE"
- [x] Updated how-it-works page
  - Changed "VALIDATION" tab content to describe feedback-first review
  - Updated rules to reflect new system (2 reviewers, all items resolved)
- [x] Updated FeedContainer.tsx
  - Changed "STRENGTHEN" label to "NEEDS WORK"

### Next Steps
- [ ] Test locally
- [ ] Run code-reviewer and dst-reviewer
- [ ] Commit and push
